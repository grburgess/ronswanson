{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "a9d8410a",
   "metadata": {},
   "source": [
    "# Intro\n",
    "\n",
    "So you need to build a table model? 3ML via astromodels provides you with nice facilities to accomplish this task. But often, we need to interface with computationally expensive simulations and require many runs of these simulations. This is a very generic task and Ron Swanson wants to make things as simple as possible for you. Making things complicated is annoying.\n",
    "\n",
    "![alt text](https://raw.githubusercontent.com/grburgess/ronswanson/master/docs/media/mad.jpg)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "32bc0e99",
   "metadata": {},
   "source": [
    "## Example with a Band function\n",
    "\n",
    "Let's say we want to make a table model from a Band function.\n",
    "\n",
    "We pick a parameter grid and a grid of energies for our simulation. We can enter these in a YAML file:\n",
    "\n",
    "```yaml\n",
    "alpha:\n",
    "  custom: no\n",
    "  vmin: -1\n",
    "  vmax: 0\n",
    "  scale: \"linear\"\n",
    "  n_points: 10\n",
    "\n",
    "beta:\n",
    "  custom: no\n",
    "  vmin: -3\n",
    "  vmax: -2\n",
    "  scale: \"linear\"\n",
    "  n_points: 10\n",
    "\n",
    "epeak:\n",
    "  custom: yes\n",
    "  values: [50., 69.74 , 97.29, 135.72, 189.32, 264.097, 368.4, 513.9, 716.87, 1000.]\n",
    "\n",
    "energy_grid:\n",
    "  custom: no\n",
    "  vmin: 10\n",
    "  vmax: 1000\n",
    "  scale: \"log\"\n",
    "  n_points: 50\n",
    "\n",
    "\n",
    "```\n",
    "\n",
    "As can be seen, we can specify the parameter/energy grids ourselves, or we can specify their ranges and let it be done for us.\n",
    "\n",
    "\n"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "bc3a2df6",
   "metadata": {},
   "source": [
    "### The Simulation class\n",
    "\n",
    "Now we need to make a class for the simulation. We will inherit from the simulation class and specify a `_run_call` function that tells the program how to run the simulation for a given set of parameters. This function **must** return an array of photon fluxes for the given energies.\n",
    "\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "b81af1ca",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-10T13:24:46.936248Z",
     "iopub.status.busy": "2022-07-10T13:24:46.935943Z",
     "iopub.status.idle": "2022-07-10T13:24:51.280937Z",
     "shell.execute_reply": "2022-07-10T13:24:51.279501Z"
    }
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[\u001b[35mWARNING \u001b[0m]\u001b[35m The naima package is not available. Models that depend on it will not be available\u001b[0m\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[\u001b[35mWARNING \u001b[0m]\u001b[35m The GSL library or the pygsl wrapper cannot be loaded. Models that depend on it will not be available.\u001b[0m\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[\u001b[35mWARNING \u001b[0m]\u001b[35m The ebltable package is not available. Models that depend on it will not be available\u001b[0m\n"
     ]
    }
   ],
   "source": [
    "from typing import Dict\n",
    "\n",
    "import numpy as np\n",
    "from astromodels import Band\n",
    "import ronswanson as dukesilver\n",
    "\n",
    "\n",
    "class BandSimulation(dukesilver.Simulation):\n",
    "    def __init__(\n",
    "        self,\n",
    "        simulation_id: int,\n",
    "        parameter_set: Dict[str, float],\n",
    "        energy_grid: np.ndarray,\n",
    "        out_file: str,\n",
    "    ) -> None:\n",
    "        super().__init__(simulation_id, parameter_set, energy_grid, out_file)\n",
    "\n",
    "    def _run_call(self) -> np.ndarray:\n",
    "\n",
    "        b = Band(\n",
    "            K=1,\n",
    "            alpha=self._parameter_set[\"alpha\"],\n",
    "            beta=self._parameter_set[\"beta\"],\n",
    "            xp=self._parameter_set[\"epeak\"],\n",
    "        )\n",
    "\n",
    "        return b(self._energy_grid)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "93a3e874",
   "metadata": {},
   "source": [
    "Now we need to tell the simulation builder a few things so it can construct our files for us. We have stored this YAML file in the repo itself. You should use your own!\n",
    "\n",
    "The `SimulationBuilder` class takes a parameter grid, the name of the file that will be created, the import line for the custom simulation class, the number of cores and nodes to execute on."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "dd33c5a4",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-10T13:24:51.286594Z",
     "iopub.status.busy": "2022-07-10T13:24:51.286027Z",
     "iopub.status.idle": "2022-07-10T13:24:51.299675Z",
     "shell.execute_reply": "2022-07-10T13:24:51.298755Z"
    }
   },
   "outputs": [],
   "source": [
    "from ronswanson.utils.package_data import get_path_of_data_file\n",
    "\n",
    "\n",
    "file_name = get_path_of_data_file(\"test_params.yml\")\n",
    "\n",
    "\n",
    "# create a parameter grid from our file\n",
    "pg = dukesilver.ParameterGrid.from_yaml(file_name)\n",
    "\n",
    "# create a simulation builder\n",
    "sb = dukesilver.SimulationBuilder(\n",
    "    pg,\n",
    "    \"database.h5\",\n",
    "    \"from ronswanson.band_simulation import BandSimulation as Simulation\",\n",
    "    n_cores=8,\n",
    "    n_nodes=None,\n",
    ")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "726ab5e1",
   "metadata": {},
   "source": [
    "Now a python file will be written to the disk which you can run to create your simulation runs. we can have a look at the file.\n",
    "\n",
    "```\n",
    "from ronswanson.band_simulation import BandSimulation as Simulation\n",
    "from joblib import Parallel, delayed\n",
    "from ronswanson import ParameterGrid\n",
    "\n",
    "pg = ParameterGrid.from_yaml('/Users/jburgess/coding/projects/ronswanson/parameters.yml')\n",
    "def func(i):\n",
    "\tparams = pg.at_index(i)\n",
    "\tsimulation = Simulation(i, params, pg.energy_grid.grid,'/Users/jburgess/coding/projects/ronswanson/database.h5')\n",
    "\tsimulation.run()\n",
    "\n",
    "iteration = [i for i in range(0, pg.n_points)]\n",
    "\n",
    "Parallel(n_jobs=8)(delayed(func)(i) for i in iteration)\n",
    "\n",
    "```"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "316dfe8d",
   "metadata": {},
   "source": [
    "Now this simply uses `joblib` to farm out the iterations over the parameter combinations. If iterations are to also be divided across HPC nodes, the python script will be modified and an associated `SLURM` script will be generated.\n",
    "\n",
    "\n",
    "### The Database\n",
    "\n",
    "\n",
    "\n",
    "Upon running the script, an HDF5 database of the runs is created which contains all the information needed to build a table model in `3ML`."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "d12ccea9",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-10T13:24:51.303843Z",
     "iopub.status.busy": "2022-07-10T13:24:51.303587Z",
     "iopub.status.idle": "2022-07-10T13:24:51.307519Z",
     "shell.execute_reply": "2022-07-10T13:24:51.306442Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "from ronswanson.utils.package_data import get_path_of_data_file\n",
    "from ronswanson import Database"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "3e6f60bb",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-10T13:24:51.311760Z",
     "iopub.status.busy": "2022-07-10T13:24:51.311152Z",
     "iopub.status.idle": "2022-07-10T13:24:51.894172Z",
     "shell.execute_reply": "2022-07-10T13:24:51.893201Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "OrderedDict([('alpha',\n",
       "              array([-1.        , -0.77777778, -0.55555556, -0.33333333, -0.11111111,\n",
       "                      0.11111111,  0.33333333,  0.55555556,  0.77777778,  1.        ])),\n",
       "             ('beta',\n",
       "              array([-3.        , -2.88888889, -2.77777778, -2.66666667, -2.55555556,\n",
       "                     -2.44444444, -2.33333333, -2.22222222, -2.11111111, -2.        ])),\n",
       "             ('epeak',\n",
       "              array([  50.        ,   69.7475397 ,   97.29438588,  135.72088083,\n",
       "                      189.32395047,  264.09759503,  368.40314986,  513.9042664 ,\n",
       "                      716.87116444, 1000.        ]))])"
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "db = Database.from_file(get_path_of_data_file(\"test_database.h5\"))\n",
    "db.parameter_ranges"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "12a5f9b4",
   "metadata": {},
   "source": [
    "Now we can use the database to construct and save a table model for `3ML`"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "67708222",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-10T13:24:51.899405Z",
     "iopub.status.busy": "2022-07-10T13:24:51.899121Z",
     "iopub.status.idle": "2022-07-10T13:24:52.584231Z",
     "shell.execute_reply": "2022-07-10T13:24:52.583250Z"
    }
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[\u001b[35mWARNING \u001b[0m]\u001b[35m Energy unit is not a Quantity instance, so units has not been provided. Using keV.\u001b[0m\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<ul>\n",
       "\n",
       "<li>description: a new model for 3ML</li>\n",
       "\n",
       "<li>formula: n.a.</li>\n",
       "\n",
       "<li>parameters: \n",
       "<ul>\n",
       "\n",
       "<li>K: \n",
       "<ul>\n",
       "\n",
       "<li>value: 1.0</li>\n",
       "\n",
       "<li>desc: None</li>\n",
       "\n",
       "<li>min_value: None</li>\n",
       "\n",
       "<li>max_value: None</li>\n",
       "\n",
       "<li>unit: </li>\n",
       "\n",
       "<li>is_normalization: False</li>\n",
       "\n",
       "<li>delta: 0.1</li>\n",
       "\n",
       "<li>free: True</li>\n",
       "\n",
       "</ul>\n",
       "\n",
       "</li>\n",
       "\n",
       "<li>scale: \n",
       "<ul>\n",
       "\n",
       "<li>value: 1.0</li>\n",
       "\n",
       "<li>desc: None</li>\n",
       "\n",
       "<li>min_value: None</li>\n",
       "\n",
       "<li>max_value: None</li>\n",
       "\n",
       "<li>unit: </li>\n",
       "\n",
       "<li>is_normalization: False</li>\n",
       "\n",
       "<li>delta: 0.1</li>\n",
       "\n",
       "<li>free: True</li>\n",
       "\n",
       "</ul>\n",
       "\n",
       "</li>\n",
       "\n",
       "<li>alpha: \n",
       "<ul>\n",
       "\n",
       "<li>value: 0.0</li>\n",
       "\n",
       "<li>desc: None</li>\n",
       "\n",
       "<li>min_value: -1.0</li>\n",
       "\n",
       "<li>max_value: 1.0</li>\n",
       "\n",
       "<li>unit: </li>\n",
       "\n",
       "<li>is_normalization: False</li>\n",
       "\n",
       "<li>delta: 0.1</li>\n",
       "\n",
       "<li>free: True</li>\n",
       "\n",
       "</ul>\n",
       "\n",
       "</li>\n",
       "\n",
       "<li>beta: \n",
       "<ul>\n",
       "\n",
       "<li>value: -2.5</li>\n",
       "\n",
       "<li>desc: None</li>\n",
       "\n",
       "<li>min_value: -3.0</li>\n",
       "\n",
       "<li>max_value: -2.0</li>\n",
       "\n",
       "<li>unit: </li>\n",
       "\n",
       "<li>is_normalization: False</li>\n",
       "\n",
       "<li>delta: 0.25</li>\n",
       "\n",
       "<li>free: True</li>\n",
       "\n",
       "</ul>\n",
       "\n",
       "</li>\n",
       "\n",
       "<li>epeak: \n",
       "<ul>\n",
       "\n",
       "<li>value: 226.71077275</li>\n",
       "\n",
       "<li>desc: None</li>\n",
       "\n",
       "<li>min_value: 50.0</li>\n",
       "\n",
       "<li>max_value: 1000.0</li>\n",
       "\n",
       "<li>unit: </li>\n",
       "\n",
       "<li>is_normalization: False</li>\n",
       "\n",
       "<li>delta: 22.671077275000002</li>\n",
       "\n",
       "<li>free: True</li>\n",
       "\n",
       "</ul>\n",
       "\n",
       "</li>\n",
       "\n",
       "</ul>\n",
       "\n",
       "</li>\n",
       "\n",
       "</ul>\n"
      ],
      "text/plain": [
       "  * description: a new model for 3ML\n",
       "  * formula: n.a.\n",
       "  * parameters:\n",
       "    * K:\n",
       "      * value: 1.0\n",
       "      * desc: None\n",
       "      * min_value: null\n",
       "      * max_value: null\n",
       "      * unit: ''\n",
       "      * is_normalization: false\n",
       "      * delta: 0.1\n",
       "      * free: true\n",
       "    * scale:\n",
       "      * value: 1.0\n",
       "      * desc: None\n",
       "      * min_value: null\n",
       "      * max_value: null\n",
       "      * unit: ''\n",
       "      * is_normalization: false\n",
       "      * delta: 0.1\n",
       "      * free: true\n",
       "    * alpha:\n",
       "      * value: 0.0\n",
       "      * desc: None\n",
       "      * min_value: -1.0\n",
       "      * max_value: 1.0\n",
       "      * unit: ''\n",
       "      * is_normalization: false\n",
       "      * delta: 0.1\n",
       "      * free: true\n",
       "    * beta:\n",
       "      * value: -2.5\n",
       "      * desc: None\n",
       "      * min_value: -3.0\n",
       "      * max_value: -2.0\n",
       "      * unit: ''\n",
       "      * is_normalization: false\n",
       "      * delta: 0.25\n",
       "      * free: true\n",
       "    * epeak:\n",
       "      * value: 226.71077275\n",
       "      * desc: None\n",
       "      * min_value: 50.0\n",
       "      * max_value: 1000.0\n",
       "      * unit: ''\n",
       "      * is_normalization: false\n",
       "      * delta: 22.671077275000002\n",
       "      * free: true"
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "table_model = db.to_3ml(\"my_model\", \"a new model for 3ML\")\n",
    "table_model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "a23b07d6",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-10T13:24:52.589853Z",
     "iopub.status.busy": "2022-07-10T13:24:52.589523Z",
     "iopub.status.idle": "2022-07-10T13:24:55.016785Z",
     "shell.execute_reply": "2022-07-10T13:24:55.015548Z"
    }
   },
   "outputs": [],
   "source": [
    "import matplotlib.pyplot as plt\n",
    "from astromodels import Band\n",
    "\n",
    "%matplotlib inline"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "b2d1a5f5",
   "metadata": {},
   "source": [
    "We can compare our table model with the Band function."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "e39c8a30",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-10T13:24:55.022245Z",
     "iopub.status.busy": "2022-07-10T13:24:55.021171Z",
     "iopub.status.idle": "2022-07-10T13:24:58.125159Z",
     "shell.execute_reply": "2022-07-10T13:24:58.124216Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "<matplotlib.legend.Legend at 0x7fd88a3a9040>"
      ]
     },
     "execution_count": 7,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "ene = np.geomspace(10, 1000, 100)\n",
    "\n",
    "b = Band()\n",
    "b.alpha = -0.6\n",
    "b.beta = -2.5\n",
    "b.xp = 250\n",
    "b.K = 1.05\n",
    "\n",
    "table_model.alpha = -0.6\n",
    "table_model.beta = -2.5\n",
    "table_model.epeak = 250\n",
    "\n",
    "\n",
    "fig, ax = plt.subplots()\n",
    "\n",
    "ax.loglog(\n",
    "    ene, ene**2 * table_model(ene), color='#33FFC4', lw=3, label=\"table\"\n",
    ")\n",
    "ax.loglog(ene, ene**2 * b(ene), color='#C989FB', lw=3, label=\"band\")\n",
    "\n",
    "ax.set(xlabel=\"energy\", ylabel=\"vFv\")\n",
    "\n",
    "ax.legend()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "4c9c7bb0",
   "metadata": {},
   "source": [
    "Great! That was way easier than programming everything yourself.\n",
    "\n",
    "![alt text](https://raw.githubusercontent.com/grburgess/ronswanson/master/docs/media/happy.jpeg)\n",
    "\n",
    "\n",
    "Suppose we did not want to use all the values in the parameter ranges we have simulated. Bigger interpolation tables take up memory when fitting.\n",
    "\n",
    "We can select a subset of the parameter ranges when building the table"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "2ee1afdd",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-10T13:24:58.129673Z",
     "iopub.status.busy": "2022-07-10T13:24:58.129308Z",
     "iopub.status.idle": "2022-07-10T13:24:58.365603Z",
     "shell.execute_reply": "2022-07-10T13:24:58.364553Z"
    }
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[\u001b[35mWARNING \u001b[0m]\u001b[35m Energy unit is not a Quantity instance, so units has not been provided. Using keV.\u001b[0m\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<ul>\n",
       "\n",
       "<li>description: a new model for 3ML</li>\n",
       "\n",
       "<li>formula: n.a.</li>\n",
       "\n",
       "<li>parameters: \n",
       "<ul>\n",
       "\n",
       "<li>K: \n",
       "<ul>\n",
       "\n",
       "<li>value: 1.0</li>\n",
       "\n",
       "<li>desc: None</li>\n",
       "\n",
       "<li>min_value: None</li>\n",
       "\n",
       "<li>max_value: None</li>\n",
       "\n",
       "<li>unit: </li>\n",
       "\n",
       "<li>is_normalization: False</li>\n",
       "\n",
       "<li>delta: 0.1</li>\n",
       "\n",
       "<li>free: True</li>\n",
       "\n",
       "</ul>\n",
       "\n",
       "</li>\n",
       "\n",
       "<li>scale: \n",
       "<ul>\n",
       "\n",
       "<li>value: 1.0</li>\n",
       "\n",
       "<li>desc: None</li>\n",
       "\n",
       "<li>min_value: None</li>\n",
       "\n",
       "<li>max_value: None</li>\n",
       "\n",
       "<li>unit: </li>\n",
       "\n",
       "<li>is_normalization: False</li>\n",
       "\n",
       "<li>delta: 0.1</li>\n",
       "\n",
       "<li>free: True</li>\n",
       "\n",
       "</ul>\n",
       "\n",
       "</li>\n",
       "\n",
       "<li>alpha: \n",
       "<ul>\n",
       "\n",
       "<li>value: -0.5555555555555556</li>\n",
       "\n",
       "<li>desc: None</li>\n",
       "\n",
       "<li>min_value: -1.0</li>\n",
       "\n",
       "<li>max_value: -0.11111111111111116</li>\n",
       "\n",
       "<li>unit: </li>\n",
       "\n",
       "<li>is_normalization: False</li>\n",
       "\n",
       "<li>delta: 0.05555555555555556</li>\n",
       "\n",
       "<li>free: True</li>\n",
       "\n",
       "</ul>\n",
       "\n",
       "</li>\n",
       "\n",
       "<li>beta: \n",
       "<ul>\n",
       "\n",
       "<li>value: -2.5</li>\n",
       "\n",
       "<li>desc: None</li>\n",
       "\n",
       "<li>min_value: -3.0</li>\n",
       "\n",
       "<li>max_value: -2.0</li>\n",
       "\n",
       "<li>unit: </li>\n",
       "\n",
       "<li>is_normalization: False</li>\n",
       "\n",
       "<li>delta: 0.25</li>\n",
       "\n",
       "<li>free: True</li>\n",
       "\n",
       "</ul>\n",
       "\n",
       "</li>\n",
       "\n",
       "<li>epeak: \n",
       "<ul>\n",
       "\n",
       "<li>value: 368.40314986</li>\n",
       "\n",
       "<li>desc: None</li>\n",
       "\n",
       "<li>min_value: 264.09759503</li>\n",
       "\n",
       "<li>max_value: 513.9042664</li>\n",
       "\n",
       "<li>unit: </li>\n",
       "\n",
       "<li>is_normalization: False</li>\n",
       "\n",
       "<li>delta: 36.840314986</li>\n",
       "\n",
       "<li>free: True</li>\n",
       "\n",
       "</ul>\n",
       "\n",
       "</li>\n",
       "\n",
       "</ul>\n",
       "\n",
       "</li>\n",
       "\n",
       "</ul>\n"
      ],
      "text/plain": [
       "  * description: a new model for 3ML\n",
       "  * formula: n.a.\n",
       "  * parameters:\n",
       "    * K:\n",
       "      * value: 1.0\n",
       "      * desc: None\n",
       "      * min_value: null\n",
       "      * max_value: null\n",
       "      * unit: ''\n",
       "      * is_normalization: false\n",
       "      * delta: 0.1\n",
       "      * free: true\n",
       "    * scale:\n",
       "      * value: 1.0\n",
       "      * desc: None\n",
       "      * min_value: null\n",
       "      * max_value: null\n",
       "      * unit: ''\n",
       "      * is_normalization: false\n",
       "      * delta: 0.1\n",
       "      * free: true\n",
       "    * alpha:\n",
       "      * value: -0.5555555555555556\n",
       "      * desc: None\n",
       "      * min_value: -1.0\n",
       "      * max_value: -0.11111111111111116\n",
       "      * unit: ''\n",
       "      * is_normalization: false\n",
       "      * delta: 0.05555555555555556\n",
       "      * free: true\n",
       "    * beta:\n",
       "      * value: -2.5\n",
       "      * desc: None\n",
       "      * min_value: -3.0\n",
       "      * max_value: -2.0\n",
       "      * unit: ''\n",
       "      * is_normalization: false\n",
       "      * delta: 0.25\n",
       "      * free: true\n",
       "    * epeak:\n",
       "      * value: 368.40314986\n",
       "      * desc: None\n",
       "      * min_value: 264.09759503\n",
       "      * max_value: 513.9042664\n",
       "      * unit: ''\n",
       "      * is_normalization: false\n",
       "      * delta: 36.840314986\n",
       "      * free: true"
      ]
     },
     "execution_count": 8,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "selection = {}\n",
    "selection['alpha'] = dict(vmax=0)\n",
    "selection['epeak'] = dict(vmin=200, vmax=700)\n",
    "\n",
    "table_model_small = db.to_3ml(\n",
    "    \"my_model_small\", \"a new model for 3ML\", **selection\n",
    ")\n",
    "table_model_small"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "67f7dded",
   "metadata": {},
   "source": [
    "Awesome! Now go enjoy your weekend.\n",
    "\n",
    "![alt text](https://raw.githubusercontent.com/grburgess/ronswanson/master/docs/media/enjoy.jpg)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "e5baa55c",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "jupytext": {
   "formats": "ipynb,md"
  },
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.8.13"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
